using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;
using System.IO;
using System.Windows.Forms;
using Excel = Microsoft.Office.Interop.Excel;

namespace Vulnerability
{
    class Save
    {
        public void SaveToFile(int[] arr, string filename)
        {
            SaveFileDialog save = new SaveFileDialog();
            //int offset = (int)numOffset.Value;
            // save - имя компонента SaveFileDialog
            string Fname = ""; // для имени файла
            // задание начальной директории
            save.InitialDirectory = @"С:\";
            // задание свойства Filter
            save.Filter = "txt files (*.txt)|*.txt";
            // задание свойства FilterIndex – выбор типа файла
            save.FilterIndex = 1;
            // свойство Title - название окна диалога выбора файла
            save.Title = "Save file as";
            if (save.ShowDialog() == DialogResult.OK)
            { // получаем имя файла для сохранения данных
                Fname = save.FileName;
                // выделяем память для объекта типа FileStream 
                FileStream fs = new FileStream(Fname, FileMode.Create, FileAccess.Write);
                if (fs != null) // в случае успеха создаем объект
                { // типа StreamWriter и ассоциируем его с объектом fs
                    StreamWriter wr = new StreamWriter(fs);
                    // записываем данные
                    //wr.WriteLine(offset);
                    for (int i = 0; i < arr.Count(); ++i)
                        //{ // построчно пишем массив чисел типа float в поток
                        if (i <= 9)
                            wr.WriteLine("0" + (i + 1) + " неделя " + arr[i] + " уязвимостей");
                        else
                            wr.WriteLine((i + 1) + " неделя " + arr[i] + " уязвимостей");
                    //}
                    // переносим данные из объекта fs в файл
                    wr.Flush();
                    // закрываем объекты wr и fs
                    wr.Close();
                    fs.Close();
                }
            }
        }

        public static void SaveInFile(List<double> Vuln, List<double> ForecExp, List<double> ErrExp, List<double> ForecSc, List<double> ErrSc)
        {
            Excel.Application excel = new Excel.Application();
            excel.SheetsInNewWorkbook = 1;
            excel.Workbooks.Add(Type.Missing);
            Excel.Workbook workbook = excel.Workbooks[1]; //получам ссылку на первую открытую книгу
            Excel.Worksheet sheet = workbook.Worksheets.get_Item(1);//получаем ссылку на первый лист
            /*Excel.Worksheet worksheet = workbook.Worksheets["Лист1"];
            worksheet.Name = "mysql эксп";*/
            sheet.Cells[1, 1].Value = "Уязвимости, часы";
            sheet.Cells[1, 2].Value = "Прогнозирование экспоненциальное";
            sheet.Cells[1, 3].Value = "Ошибки прогнозирования экспоненциального";
            sheet.Cells[1, 4].Value = "Прогнозирование средней скользящей";
            sheet.Cells[1, 5].Value = "Ошибки прогнозирования средней скользящей";
            for (int i = 2; i < Vuln.Count(); i++)
                sheet.Cells[i, 1].Value = Vuln[i];
            for (int i = 2; i < ForecExp.Count(); i++)
                sheet.Cells[i, 2].Value = ForecExp[i];
            for (int i = 2; i < ErrExp.Count(); i++)
                sheet.Cells[i, 3].Value = ErrExp[i];
            for (int i = 2; i < ForecSc.Count(); i++)
                sheet.Cells[i, 4].Value = ForecSc[i];
            for (int i = 2; i < ErrSc.Count(); i++)
                sheet.Cells[i, 5].Value = ErrSc[i];
            excel.Visible = true;
        }

        public static void SaveInFile(int countRow, int countColumn, string[,] data)
        {
            Excel.Application excel = new Excel.Application();
            excel.SheetsInNewWorkbook = 3;
            excel.Workbooks.Add(Type.Missing);
            Excel.Workbook workbook = excel.Workbooks[1]; //получам ссылку на первую открытую книгу
            Excel.Worksheet sheet = workbook.Worksheets.get_Item(1);//получаем ссылку на первый лист
            Excel.Worksheet worksheet = workbook.Worksheets["Лист1"];
            worksheet.Name = "mysql";
            Excel.Worksheet sheet2 = workbook.Worksheets.get_Item(2);
            worksheet = workbook.Worksheets["Лист2"];
            worksheet.Name = "oracle";
            Excel.Worksheet sheet3 = workbook.Worksheets.get_Item(3);
            worksheet = workbook.Worksheets["Лист3"];
            worksheet.Name = "postgresql";

            int mysqlCount = 2, oracleCount = 2, mssqlCount = 2;
            int countMysql = 0, countMssql = 0, countOracle = 0;

            for (int j = 1; j < countColumn + 1; j++)
            {
                sheet.Cells[1, j].Value = data[0, j - 1];
                sheet2.Cells[1, j].Value = data[0, j - 1];
                sheet3.Cells[1, j].Value = data[0, j - 1];
            }

            for (int i = 1; i <= countRow; i++)
            {
                for (int j = 1; j < countColumn + 1; j++)
                {
                    if (data[i - 1, 2] == "mysql")
                    {
                        sheet.Cells[mysqlCount, j].Value = data[i - 1, j - 1]; 
                        countMysql++;
                        if (countMysql > 7)
                        {
                            mysqlCount++;
                            countMysql = 0;
                        }
                    }
                    if (data[i - 1, 2] == "oracle")
                    {
                        sheet2.Cells[oracleCount, j].Value = data[i - 1, j - 1];
                        countOracle++;
                        if (countOracle > 7)
                        {
                            oracleCount++;
                            countOracle = 0;
                        }
                    }
                    if (data[i - 1, 2] == "postgresql")
                    {
                        sheet3.Cells[mssqlCount, j].Value = data[i - 1, j - 1];
                        countMssql++;
                        if (countMssql > 7)
                        {
                            mssqlCount++;
                            countMssql = 0;
                        }
                    }
                }
            }

            //делаем их жирными
            //sheet.Cells.get_Range("A1", "A10").Font.Bold = true;
            excel.Visible = true; // открытие Excel
        }
    }
}