using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;
using System.Globalization;
using System.Windows.Forms;

namespace Vulnerability
{
    class CountVulnerability
    {
        public int[] CountVulnerabilityYear(List<DateTime> datetime, string year)
        {
            DateTimeFormatInfo dfi = DateTimeFormatInfo.CurrentInfo;
            //DateTime dt = Convert.ToDateTime("31.12." + year);
            Calendar c = dfi.Calendar;
            //int countWeek = c.GetWeekOfYear(dt, dfi.CalendarWeekRule, dfi.FirstDayOfWeek);
            int[] countVul = new int[1];
            for (int j = 0; j < 1; j++)
                countVul[j] = 0;
            for (int i = 0; i < datetime.Count; i++)
                if (Convert.ToString(datetime[i].Year) == year)
                {
                    //int week = c.GetWeekOfYear(datetime[i], dfi.CalendarWeekRule, dfi.FirstDayOfWeek);
                    countVul[0]++;
                }
            return countVul;
        }

        public int[] CountVulnerabilityQuarter(List<DateTime> datetime, string year)
        {
            DateTimeFormatInfo dfi = DateTimeFormatInfo.CurrentInfo;
            Calendar c = dfi.Calendar;
            int countQuarter = 4;
            int[] countVul = new int[countQuarter];
            for (int j = 0; j < countQuarter; j++)
                countVul[j] = 0;
            for (int i = 0; i < datetime.Count; i++)
                if (Convert.ToString(datetime[i].Year) == year)
                {
                    //int week = c.GetWeekOfYear(datetime[i], dfi.CalendarWeekRule, dfi.FirstDayOfWeek);
                    int month = datetime[i].Month;
                    int quarter = 1;
                    if (month < 4)
                        quarter = 1;
                    if (month > 3 && month < 7)
                        quarter = 2;
                    if (month > 6 && month < 10)
                        quarter = 3;
                    if (month > 9)
                        quarter = 4;
                    countVul[quarter - 1]++;
                }
            return countVul;
        }

        public int[] CountVulnerabilityWeek(List<DateTime> datetime, string year)
        {
            //недель 53
            DateTimeFormatInfo dfi = DateTimeFormatInfo.CurrentInfo;
            DateTime dt = Convert.ToDateTime("31.12." + year);
            Calendar c = dfi.Calendar;
            int countWeek = c.GetWeekOfYear(dt, dfi.CalendarWeekRule, dfi.FirstDayOfWeek);
            int[] countVul = new int[countWeek];
            for (int j = 0; j < countWeek; j++)
                countVul[j] = 0;
            for (int i = 0; i < datetime.Count; i++)
                if (Convert.ToString(datetime[i].Year) == year)
                {
                    int week = c.GetWeekOfYear(datetime[i], dfi.CalendarWeekRule, dfi.FirstDayOfWeek);
                    countVul[week - 1]++;
                }
            return countVul;
        }

        public int[] CountVulnerabilityMonth(List<DateTime> datetime, string year)
        {
            DateTimeFormatInfo dfi = DateTimeFormatInfo.CurrentInfo;
            //DateTime dt = Convert.ToDateTime("31.12.2014 0:55:06");
            Calendar c = dfi.Calendar;
            int countMonth = 12;// c.GetWeekOfYear(dt, dfi.CalendarWeekRule, dfi.FirstDayOfWeek);
            int[] countVul = new int[countMonth];
            for (int j = 0; j < countMonth; j++)
                countVul[j] = 0;
            for (int i = 0; i < datetime.Count; i++)
                if (Convert.ToString(datetime[i].Year) == year)
                {
                    //int week = c.GetWeekOfYear(datetime[i], dfi.CalendarWeekRule, dfi.FirstDayOfWeek);
                    int month = datetime[i].Month;
                    countVul[month - 1]++;
                }
            return countVul;
        }

        /*public Dictionary<DateTime, int> CountVuln(List<DateTime> datetime)
        {
            Dictionary<DateTime, int> countVul = new Dictionary<DateTime, int>();
            int count = 1;
            for (int i = 1; i < datetime.Count; i++)
            {
                if (datetime[i - 1] == datetime[i])
                    count++;
                if (datetime[i - 1] != datetime[i])
                {
                    countVul.Add(datetime[i-1], count);
                    count = 1;
                }
                try
                {
                    if (i == datetime.Count - 1)
                        countVul.Add(datetime[i - 1], count);
                }
                catch (ArgumentException)
                {
                    DateTime LastElement = DateTime.Now;
                    foreach (var f in countVul.Keys)
                        LastElement = f;
                    foreach (var f in countVul.Values)
                        count = f;
                        countVul[LastElement] = ++count;
                    //countVul.Add(datetime[i - 1], count++);
                }
            }
            return countVul;
        }*/

        public List<DateTime> CountVuln(List<DateTime> datetime)
        {
            List<DateTime> countVul = new List<DateTime>();
            countVul.Add(datetime[0]);
            for (int i = 1; i < datetime.Count; i++)
            {
                if (datetime[i - 1] != datetime[i])
                    countVul.Add(datetime[i]);
            }
            return countVul;
        }
    }
}