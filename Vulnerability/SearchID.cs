using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;
using System.Xml;

namespace Vulnerability
{
    class SearchID
    {
        public List<string> Search(string path)
        {
            List<string> ID = new List<string>();
            using (XmlReader xml = XmlReader.Create(path))//nvdcve-2.0-2014
            {
                while (xml.Read())
                {
                    string id2 = "";
                    switch (xml.NodeType)
                    {
                        case XmlNodeType.Element:
                            if (xml.Name == "entry")
                            {
                                EntryType entry = new EntryType(xml.ReadOuterXml());
                                if (entry.VulnerableSoftwareList != null)
                                {
                                    for (int i = 0; i < entry.VulnerableSoftwareList.Products.Count(); i++)
                                        if ((entry.VulnerableSoftwareList.Products[i].IndexOf("mysql:mysql") != -1)
                                            || (entry.VulnerableSoftwareList.Products[i].IndexOf("postgresql:postgresql") != -1)// microsoft:sql_server
                                            || (entry.VulnerableSoftwareList.Products[i].IndexOf("oracle:mysql") != -1)
                                            || (entry.VulnerableSoftwareList.Products[i].IndexOf("oracle:database") != -1))
                                        {
                                            if (id2 != entry.id)
                                            {
                                                ID.Add(entry.id);
                                                id2 = entry.id;
                                            }
                                        }
                                }
                            }
                            break;
                    }
                }
            }
            return ID;
        }
    }
}