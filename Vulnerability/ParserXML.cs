using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;
using System.Xml;

namespace Vulnerability
{
    class ParserXML
    {
        private void Parser(string path)
        {
            SearchID search = new SearchID();
            using (XmlReader xml = XmlReader.Create(path))//nvdcve-2.0-2014
            {
                while (xml.Read())
                {
                    switch (xml.NodeType)
                    {
                        case XmlNodeType.Element:
                            if (xml.Name == "entry")
                            {
                                EntryType entry = new EntryType(xml.ReadOuterXml());
                                EntryType entry2 = new EntryType(xml.ReadOuterXml());
                                foreach (var f in search.Search(path))
                                    if (entry.id == f)
                                    {
                                        //richTextBox1.Text += entry.id;// +Environment.NewLine;
                                        //richTextBox1.Text += entry.PublishedDateTime;// +Environment.NewLine;
                                        if (entry.VulnerableSoftwareList != null)
                                        {
                                            for (int i = 0; i < entry.VulnerableSoftwareList.Products.Count(); i++)
                                                if ((entry.VulnerableSoftwareList.Products[i].IndexOf("mysql:mysql") != -1)
                                            || (entry.VulnerableSoftwareList.Products[i].IndexOf("postgresql:postgresql") != -1) // microsoft:sql_server
                                            || (entry.VulnerableSoftwareList.Products[i].IndexOf("oracle:mysql") != -1)
                                            || (entry.VulnerableSoftwareList.Products[i].IndexOf("oracle:database") != -1))
                                                {
                                                    //richTextBox1.Text += entry.VulnerableSoftwareList.Products[i] + Environment.NewLine;
                                                    entry2.VulnerableSoftwareList.Products[i] = entry.VulnerableSoftwareList.Products[i];
                                                }
                                        }
                                    }
                            }
                            break;
                    }
                }
            }
        }
    }
}